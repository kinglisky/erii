<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>åŸºäº WebRtc æ­å»ºä¸€ä¸ªç®€å•çš„è§†å±èŠå¤©å®¤ â€¢ èŠŠé‡</title><meta name="description" content="åŸºäº WebRtc æ­å»ºä¸€ä¸ªç®€å•çš„è§†å±èŠå¤©å®¤ - kinglisky"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="èŠŠé‡"></head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="èŠŠé‡"><img class="logo-image" src="/logo.svg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="https://github.com/kinglisky" target="_blank">GITHUB</a></li></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">åŸºäº WebRtc æ­å»ºä¸€ä¸ªç®€å•çš„è§†å±èŠå¤©å®¤</h1><div class="post-info"><a></a>2017-05-28</div><div class="post-content"><p>github pages è‡ªå®šä¹‰åŸŸåçš„ https è¿˜æ²¡é…ç½®ï¼Œchrome å¼ºåˆ¶è¦æ±‚ WebRtc ä¸Š https çš„ï¼Œè¿™ä¸ªæŠŠæ —å­æŒ‚ coding äº†</p>
<p><a href="https://kingli.coding.me/echat/#/" target="_blank" rel="noopener">è¯•ä¸€æ³¢</a> <a href="https://github.com/kinglisky/echat" target="_blank" rel="noopener">https://github.com/kinglisky/echat</a></p>
<p>åªåšæˆäº†ç®€å•çš„ä¸¤äººè§†é¢‘ï¼Œè¾“å…¥åŒæ ·çš„æˆ¿é—´å·è¿›å…¥åŒä¸€ä¸ªæˆ¿é—´å°±è¡Œäº†ï¼Œé‡ç‹—æˆ–è€…ç½‘ç»œçš„åŸå› ä¸æˆåŠŸå¯ä»¥æ¢ä¸ªæˆ¿é—´è¯•è¯• ğŸ˜ã€‚</p>
<a id="more"></a>
<h2 id="WebRtc"><a href="#WebRtc" class="headerlink" title="WebRtc"></a>WebRtc</h2><p>ç»´åŸºçš„å®šä¹‰ï¼šWebRTCï¼Œåç§°æºè‡ªç½‘é¡µå³æ—¶é€šä¿¡ï¼ˆè‹±è¯­ï¼šWeb Real-Time Communicationï¼‰çš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒç½‘é¡µæµè§ˆå™¨è¿›è¡Œå®æ—¶è¯­éŸ³å¯¹è¯æˆ–è§†é¢‘å¯¹è¯çš„APIã€‚å®ƒäº2011å¹´6æœˆ1æ—¥å¼€æºå¹¶åœ¨Googleã€Mozillaã€Operaæ”¯æŒä¸‹è¢«çº³å…¥ä¸‡ç»´ç½‘è”ç›Ÿçš„W3Cæ¨èæ ‡å‡†</p>
<p>ç®€å•æ¥è¯´è®©æµè§ˆå™¨æä¾›JSçš„å³æ—¶é€šä¿¡æ¥å£ï¼Œå¯é€šè¿‡ä¿¡ä»¤äº¤æ¢å»ºç«‹ä¸€ä¸ªæµè§ˆå™¨ä¸æµè§ˆå™¨ä¹‹é—´ï¼ˆpeer-to-peerï¼‰çš„ä¿¡é“ï¼Œè€Œä¸ç»è¿‡æœåŠ¡å™¨ç›´æ¥å®ç°æµè§ˆå™¨ä¹‹é—´çš„ç‚¹å¯¹ç‚¹é€šè®¯ï¼Œé«˜æ•ˆçš„ç¨³å®šçš„æ•°æ®ä¼ è¾“ã€‚</p>
<h2 id="ä¸»è¦çš„ä¸‰ä¸ª-API"><a href="#ä¸»è¦çš„ä¸‰ä¸ª-API" class="headerlink" title="ä¸»è¦çš„ä¸‰ä¸ª API"></a>ä¸»è¦çš„ä¸‰ä¸ª API</h2><p>MediaStreamï¼šé€šè¿‡ MediaStream çš„ API èƒ½å¤Ÿé€šè¿‡è®¾å¤‡çš„æ‘„åƒå¤´åŠè¯ç­’è·å¾—è§†é¢‘ã€éŸ³é¢‘çš„åŒæ­¥æµ</p>
<p>RTCPeerConnectionï¼šRTCPeerConnection æ˜¯ WebRTC ç”¨äºæ„å»ºç‚¹å¯¹ç‚¹ä¹‹é—´ç¨³å®šã€é«˜æ•ˆçš„æµä¼ è¾“çš„ç»„ä»¶</p>
<p>RTCDataChannelï¼šRTCDataChannel ä½¿å¾—æµè§ˆå™¨ä¹‹é—´ï¼ˆç‚¹å¯¹ç‚¹ï¼‰å»ºç«‹ä¸€ä¸ªé«˜ååé‡ã€ä½å»¶æ—¶çš„ä¿¡é“ï¼Œå¯ä¼ è¾“ä»»æ„æ•°æ®</p>
<p>MediaStream æä¾›äº†è°ƒç”¨åª’ä½“è®¾å¤‡çš„åŠŸèƒ½</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">getUserMedia(&#123;</span><br><span class="line">  video: <span class="literal">true</span>,</span><br><span class="line">  audio: <span class="literal">true</span></span><br><span class="line">&#125;, localMediaStream =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> video = <span class="built_in">document</span>.getElementById(<span class="string">'video'</span>)</span><br><span class="line">  video.src = <span class="built_in">window</span>.URL.createObjectURL(localMediaStream)</span><br><span class="line">  video.onloadedmetadata = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Label: '</span> + localMediaStream.label)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'AudioTracks'</span>, localMediaStream.getAudioTracks())</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'VideoTracks'</span>, localMediaStream.getVideoTracks())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Reeeejected!'</span>, e)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è·å–é…ç½®çš„é…ä½“æµæ•°æ®ï¼Œå¯é€šè¿‡ URL.createObjectURL(stream) å°†åª’ä½“æµæ•°æ®è¾“å…¥åˆ° video ä¸Šï¼ŒP.S view è¦åŠ ä¸Š autoplay å¦åˆ™ä¸ä¼šè‡ªåŠ¨æ’­æ”¾</p>
<p>å¯é€šè¿‡ç›‘å¬ video.onloadedmetadata äº‹ä»¶ï¼Œè·å–æ•°æ®æµçš„ä¸€äº›ä¿¡æ¯</p>
<p>getUserMedia å¤„ç†å¯ä»¥é…ç½® video audio è¿˜å¯ä»¥é…ç½®å…¶ä»–ä¸€äº›ä¸œè¥¿å¦‚</p>
<ul>
<li>è§†é¢‘æµçš„åˆ†è¾¨ç‡ maxWidth minHeight</li>
<li>è§†é¢‘æµçš„æœ€å°å®½é«˜æ¯” MinAspectRatio</li>
<li>è§†é¢‘æµçš„æœ€å¤§å¸§é€Ÿç‡ MaxFramerate</li>
<li>â€¦â€¦</li>
</ul>
<p>RTCPeerConnection</p>
<p>WebRTC ä½¿ç”¨ RTCPeerConnection æ¥åœ¨æµè§ˆå™¨ä¹‹é—´ä¼ é€’æµæ•°æ®,WebRTC ä½¿ç”¨ RTCPeerConnection æ¥åœ¨æµè§ˆå™¨ä¹‹é—´ä¼ é€’æµæ•°æ®ï¼Œè¿™ä¸ªæµæ•°æ®é€šé“æ˜¯ç‚¹å¯¹ç‚¹çš„ï¼Œä¸éœ€è¦ç»è¿‡æœåŠ¡å™¨è¿›è¡Œä¸­è½¬ã€‚</p>
<p>å—¯ï¼Œæ­¤å¤„æ•²ä¸€ä¸‹é»‘æ¿ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯ä¸èƒ½æŠ›å¼ƒèƒ½æŠ›å¼ƒæœåŠ¡å™¨çš„ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦å®ƒæ¥ä¸ºæˆ‘ä»¬ä¼ é€’ä¿¡ä»¤ï¼ˆsignalingï¼‰æ¥å»ºç«‹è¿™ä¸ªä¿¡é“ã€‚WebRTC æ²¡æœ‰å®šä¹‰ç”¨äºå»ºç«‹ä¿¡é“çš„ä¿¡ä»¤çš„åè®®ï¼šä¿¡ä»¤å¹¶ä¸æ˜¯ RTCPeerConnection APIçš„ä¸€éƒ¨åˆ†</p>
<p>é€šè¿‡ RTCPeerConnection å»ºç«‹ç‚¹å¯¹ç‚¹é“¾æ¥è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦çš„â€¦â€¦</p>
<p>çœ‹ä¸ªå°æ —å­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨Googleçš„ stun æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">const</span> iceServer = &#123;</span><br><span class="line">  <span class="string">'iceServers'</span>: [&#123;</span><br><span class="line">    <span class="string">'url'</span>: <span class="string">'stun:stun.l.google.com:19302'</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸åå°æœåŠ¡å™¨çš„ WebSocket è¿æ¥</span></span><br><span class="line"><span class="keyword">const</span> socket = io()</span><br><span class="line"><span class="comment">// åˆ›å»ºPeerConnectionå®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> pc = <span class="keyword">new</span> PeerConnection(iceServer)</span><br><span class="line"><span class="comment">// å‘é€ICEå€™é€‰åˆ°å…¶ä»–å®¢æˆ·ç«¯</span></span><br><span class="line">pc.onicecandidate = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  socket.send(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    <span class="string">'event'</span>: <span class="string">'__ice_candidate'</span>,</span><br><span class="line">    <span class="string">'data'</span>: &#123;</span><br><span class="line">      <span class="string">'candidate'</span>: event.candidate</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœæ£€æµ‹åˆ°åª’ä½“æµè¿æ¥åˆ°æœ¬åœ°ï¼Œå°†å…¶ç»‘å®šåˆ°ä¸€ä¸ª video æ ‡ç­¾ä¸Šè¾“å‡º</span></span><br><span class="line">pc.onaddstream = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  someVideoElement.src = URL.createObjectURL(event.stream)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è·å–æœ¬åœ°çš„åª’ä½“æµï¼Œå¹¶ç»‘å®šåˆ°ä¸€ä¸ªvideoæ ‡ç­¾ä¸Šè¾“å‡ºï¼Œå¹¶ä¸”å‘é€è¿™ä¸ªåª’ä½“æµç»™å…¶ä»–å®¢æˆ·ç«¯</span></span><br><span class="line">getUserMedia(&#123;</span><br><span class="line">  <span class="string">'audio'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'video'</span>: <span class="literal">true</span></span><br><span class="line">&#125;, stream =&gt; &#123;</span><br><span class="line">    <span class="comment">// å‘é€offerå’Œanswerçš„å‡½æ•°ï¼Œå‘é€æœ¬åœ°sessionæè¿°</span></span><br><span class="line">  <span class="keyword">const</span> sendOfferFn = <span class="function"><span class="keyword">function</span> (<span class="params">desc</span>) </span>&#123;</span><br><span class="line">      pc.setLocalDescription(desc)</span><br><span class="line">      socket.send(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        <span class="string">'event'</span>: <span class="string">'__offer'</span>,</span><br><span class="line">        <span class="string">'data'</span>: &#123;</span><br><span class="line">          <span class="string">'sdp'</span>: desc</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">const</span> sendAnswerFn = <span class="function"><span class="keyword">function</span> (<span class="params">desc</span>) </span>&#123;</span><br><span class="line">      pc.setLocalDescription(desc)</span><br><span class="line">      socket.send(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        <span class="string">'event'</span>: <span class="string">'__answer'</span>,</span><br><span class="line">        <span class="string">'data'</span>: &#123;</span><br><span class="line">          <span class="string">'sdp'</span>: desc</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">// ç»‘å®šæœ¬åœ°åª’ä½“æµåˆ°videoæ ‡ç­¾ç”¨äºè¾“å‡º</span></span><br><span class="line">  myselfVideoElement.src = URL.createObjectURL(stream)</span><br><span class="line">  <span class="comment">// å‘PeerConnectionä¸­åŠ å…¥éœ€è¦å‘é€çš„æµ</span></span><br><span class="line">  pc.addStream(stream)</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯å‘é€æ–¹åˆ™å‘é€ä¸€ä¸ªofferä¿¡ä»¤ï¼Œå¦åˆ™å‘é€ä¸€ä¸ªanswerä¿¡ä»¤</span></span><br><span class="line">  <span class="keyword">if</span> (isCaller) &#123;</span><br><span class="line">    pc.createOffer(sendOfferFn)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    pc.createAnswer(sendAnswerFn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, errHandler)</span><br><span class="line"><span class="comment">// å¤„ç†åˆ°æ¥çš„ä¿¡ä»¤</span></span><br><span class="line">socket.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> json = <span class="built_in">JSON</span>.parse(event.data)</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯ä¸€ä¸ªICEçš„å€™é€‰ï¼Œåˆ™å°†å…¶åŠ å…¥åˆ° PeerConnection ä¸­</span></span><br><span class="line">  <span class="comment">// å¦åˆ™è®¾å®šå¯¹æ–¹çš„ session æè¿°ä¸ºä¼ é€’è¿‡æ¥çš„æè¿°</span></span><br><span class="line">  <span class="keyword">if</span> (json.event === <span class="string">'__ice_candidate'</span>) &#123;</span><br><span class="line">    pc.addIceCandidate(<span class="keyword">new</span> RTCIceCandidate(json.data.candidate))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    pc.setRemoteDescription(<span class="keyword">new</span> RTCSessionDescription(json.data.sdp))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WebRTC é€šè¿‡ RTCPeerConnection å»ºç«‹ç‚¹å¯¹ç‚¹é“¾æ¥ï¼Œæœ€ä¸»è¦çš„æ˜¯ä¸¤ç‚¹ï¼š</p>
<ul>
<li>ä¿¡ä»¤äº¤æ¢</li>
<li>NAT/é˜²ç«å¢™ç©¿è¶Š</li>
</ul>
<p>ä¿¡ä»¤äº¤æ¢ä¸»è¦æ˜¯äº¤æ¢ä¸‰ç±»ä¿¡æ¯ï¼š</p>
<ul>
<li>è¿æ¥æ§åˆ¶ä¿¡æ¯ï¼šåˆå§‹åŒ–æˆ–è€…å…³é—­è¿æ¥æŠ¥å‘Šé”™è¯¯ã€‚</li>
<li>ç½‘ç»œé…ç½®ï¼šå¯¹äºå¤–ç½‘ï¼Œæˆ‘ä»¬ç”µè„‘çš„ IP åœ°å€å’Œç«¯å£ï¼Ÿ</li>
<li>å¤šåª’ä½“æ•°æ®ï¼šä½¿ç”¨ä»€ä¹ˆç¼–ç è§£ç å™¨ï¼Œæµè§ˆå™¨å¯ä»¥å¤„ç†ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</li>
</ul>
<p>ä¿¡ä»¤çš„ä¸»è¦æ•°æ®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<ul>
<li>ä¼šè¯æè¿°åè®®ï¼ˆSession Description Protocolï¼‰ç¡®å®šæœ¬æœºä¸Šçš„åª’ä½“æµçš„ç‰¹æ€§ï¼Œæ¯”å¦‚åˆ†è¾¨ç‡ã€ç¼–è§£ç èƒ½åŠ›ã€‚</li>
<li>è¿æ¥ä¸¤ç«¯çš„ä¸»æœºçš„ç½‘ç»œåœ°å€ï¼ŒNAT/é˜²ç«å¢™ç©¿è¶Šï¼ˆICE Candidateï¼‰</li>
</ul>
<p>ä¸‹é¢è®²ä¸€ä¸‹æœ€æœ€ä¸»è¦çš„ä¿¡ä»¤äº¤æ¢ï¼š</p>
<p>é¦–å…ˆæ˜¯ SDP çš„äº¤æ¢ï¼š</p>
<p><img src="https://raw.githubusercontent.com/RWebRTC/Blog/pictures/pictures/jsep.png" alt="ä¿¡æ¯äº¤æ¢"></p>
<p>ä¸‹é¢æœ‰ A å’Œ B ä¸¤ä¸ªæµè§ˆå™¨ï¼Œå®ƒä»¬äº¤æ¢ä¿¡ä»¤çš„è¿‡ç¨‹å¤§æ¦‚æ˜¯ï¼š</p>
<ul>
<li>A å’Œ B å„è‡ªåˆ›å»ºè‡ªå·±çš„ RTCPeerConnection å¯¹è±¡ï¼Œç®€ç§°PCã€‚</li>
<li>A é€šè¿‡ PC æ‰€æä¾›çš„ createOffer() æ–¹æ³•å»ºç«‹ä¸€ä¸ªåŒ…å« A çš„ SDP æè¿°ç¬¦çš„ offer ä¿¡ä»¤</li>
<li>A é€šè¿‡ PC æ‰€æä¾›çš„ setLocalDescription() æ–¹æ³•ï¼Œå°† A çš„ SDP æè¿°ç¬¦äº¤ç»™ A çš„ PC å®ä¾‹</li>
<li>A å°†ä¿¡ä»¤ç»è¿‡æœåŠ¡å™¨å‘ç»™B</li>
<li>B å°† A çš„ offer ä¿¡ä»¤ä¸­æ‰€åŒ…å«çš„çš„ SDP æè¿°ç¬¦æå–å‡ºæ¥ï¼Œé€šè¿‡ PC æ‰€æä¾›çš„ setRemoteDescription() æ–¹æ³•äº¤ç»™ B çš„ PC å®ä¾‹</li>
<li>B é€šè¿‡ PC æ‰€æä¾›çš„ createAnswer() æ–¹æ³•å»ºç«‹ä¸€ä¸ªåŒ…å« B çš„ SDP æè¿°ç¬¦ answer ä¿¡ä»¤</li>
<li>B é€šè¿‡ PC æ‰€æä¾›çš„ setLocalDescription() æ–¹æ³•ï¼Œå°† B çš„ SDP æè¿°ç¬¦äº¤ç»™ B çš„ PC å®ä¾‹</li>
<li>B å°† answer ä¿¡ä»¤é€šè¿‡æœåŠ¡å™¨å‘é€ç»™ A</li>
<li>A æ¥æ”¶åˆ° B çš„ answer ä¿¡ä»¤åï¼Œå°†å…¶ä¸­ B çš„ SDP æè¿°ç¬¦æå–å‡ºæ¥ï¼Œè°ƒç”¨ setRemoteDescripttion() æ–¹æ³•äº¤ç»™Aè‡ªå·±çš„ PC å®ä¾‹</li>
</ul>
<p>ç®€å•æ¥æè¿°å°±æ˜¯ï¼š</p>
<ul>
<li>A åˆ›å»º offerã€‚</li>
<li>A  â€”â€”â€“ å‘é€offer â€”â€”â€“&gt; B</li>
<li>B æ¥æ”¶ A çš„ offer å¹¶è®¾ç½®ï¼Œå¹¶ç”± B åˆ›å»º anwerã€‚</li>
<li>B  â€”â€”â€“ å‘é€ anwer â€”â€”â€“&gt; A</li>
<li>A æ¥æ”¶ B çš„ anwer å¹¶è®¾ç½®</li>
</ul>
<p>é€šè¿‡åœ¨è¿™ä¸€ç³»åˆ—çš„ä¿¡ä»¤äº¤æ¢ä¹‹åï¼ŒA å’Œ B æ‰€åˆ›å»ºçš„ PC å®ä¾‹éƒ½åŒ…å« A å’Œ B çš„ SDP æè¿°ç¬¦äº†ã€‚æˆ‘ä»¬è¿˜éœ€è¦äº¤æ¢ä¸¤ç«¯ä¸»æœºçš„ç½‘ç»œåœ°å€ï¼Œå³ ICE Candidate çš„äº¤æ¢</p>
<p>ICE çš„äº¤æ¢å…¶å®å‘ç”Ÿåœ¨ A å’Œ B çš„ SDP æè¿°ç¬¦äº¤æ¢æœŸé—´ã€‚ç®€å•æ¥è¯´ï¼š</p>
<ul>
<li>A åˆ›å»ºå®Œ PC å®ä¾‹åå¹¶ä¸ºå…¶æ·»åŠ  onicecandidate äº‹ä»¶å›è°ƒã€‚</li>
<li>å½“ A ç½‘ç»œå€™é€‰å¯ç”¨æ—¶ï¼Œå°†ä¼šè°ƒç”¨ onicecandidate å‡½æ•°ï¼Œå›è°ƒå‡½æ•°ä¸­åŒ…å« A çš„ ICE æè¿°ã€‚</li>
<li>A é€šè¿‡ä¸­è½¬æ‹‚å»å…¶å‘é€ ICE ç»™ B</li>
<li>B æ¥æ”¶å¹¶è°ƒç”¨ PC çš„ addIceCandidate() å°† A çš„ ICE æè¿°ç¬¦åŠ å…¥ï¼Œä»è€Œè·å–åˆ°Açš„ç½‘ç»œåœ°å€ã€‚</li>
</ul>
<p>ICE äº¤æ¢åªéœ€è¦ä¸€æ–¹å«æœ‰å¦ä¸€æ–¹çš„ ICE æè¿°å°±è¡Œï¼Œä¸éœ€è¦å’Œ SDP äº¤æ¢ä¸€æ ·éœ€è¦ç›¸äº’äº¤æ¢ã€‚</p>
<p><a href="https://webrtc.github.io/samples/src/content/peerconnection/munge-sdp/" target="_blank" rel="noopener">çœ‹ä¸ªæ —å­å§!</a></p>
<p>ä¼šè¯æè¿°åè®® SDP å¤§æ¦‚é•¿è¿™ä¸ªæ ·å­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">v=0</span><br><span class="line">o=- 6375483060215944758 2 IN IP4 127.0.0.1</span><br><span class="line">s=-</span><br><span class="line">t=0 0</span><br><span class="line">a=group:BUNDLE audio video</span><br><span class="line">a=msid-semantic: WMS d4d74bdc-e8fc-4164-b3ae-3b0297f8753a</span><br><span class="line">m=audio 9 UDP/TLS/RTP/SAVPF 111 103 104 9 0 8 106 105 13 110 112 113 126</span><br><span class="line">c=IN IP4 0.0.0.0</span><br><span class="line">a=rtcp:9 IN IP4 0.0.0.0</span><br><span class="line">a=ice-ufrag:UFws</span><br><span class="line">a=ice-pwd:z/R+qm/srgbLR4yHEMzewIO/</span><br><span class="line">a=fingerprint:sha-256 C0:0A:70:6A:3C:3A:02:93:23:DD:3E:F3:9F:EC:A3:C9:9F:4C:55:5A:C5:5D:B2:EB:C0:F1:FE:E5:DE:A3:E7:F5</span><br><span class="line">a=setup:actpass</span><br><span class="line">a=mid:audio</span><br><span class="line">a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level</span><br><span class="line">a=sendrecv</span><br><span class="line">a=rtcp-mux</span><br><span class="line">a=rtpmap:111 opus/48000/2</span><br><span class="line">a=rtcp-fb:111 transport-cc</span><br><span class="line">a=fmtp:111 minptime=10;useinbandfec=1</span><br><span class="line">a=rtpmap:103 ISAC/16000</span><br><span class="line">a=rtpmap:104 ISAC/32000</span><br><span class="line">a=rtpmap:9 G722/8000</span><br><span class="line">a=rtpmap:0 PCMU/8000</span><br><span class="line">a=rtpmap:8 PCMA/8000</span><br><span class="line">a=rtpmap:106 CN/32000</span><br><span class="line">a=rtpmap:105 CN/16000</span><br><span class="line">a=rtpmap:13 CN/8000</span><br><span class="line">a=rtpmap:110 telephone-event/48000</span><br><span class="line">a=rtpmap:112 telephone-event/32000</span><br><span class="line">a=rtpmap:113 telephone-event/16000</span><br><span class="line">a=rtpmap:126 telephone-event/8000</span><br><span class="line">a=ssrc:1772214208 cname:wR/OHdsj6KVnPajs</span><br><span class="line">a=ssrc:1772214208 msid:d4d74bdc-e8fc-4164-b3ae-3b0297f8753a 8fdf8579-2db4-4c80-b123-e8ed1e2bedfa</span><br><span class="line">a=ssrc:1772214208 mslabel:d4d74bdc-e8fc-4164-b3ae-3b0297f8753a</span><br><span class="line">a=ssrc:1772214208 label:8fdf8579-2db4-4c80-b123-e8ed1e2bedfa</span><br><span class="line">m=video 9 UDP/TLS/RTP/SAVPF 96 98 100 102 127 97 99 101 125</span><br><span class="line">c=IN IP4 0.0.0.0</span><br><span class="line">a=rtcp:9 IN IP4 0.0.0.0</span><br><span class="line">a=ice-ufrag:UFws</span><br><span class="line">a=ice-pwd:z/R+qm/srgbLR4yHEMzewIO/</span><br><span class="line">a=fingerprint:sha-256 C0:0A:70:6A:3C:3A:02:93:23:DD:3E:F3:9F:EC:A3:C9:9F:4C:55:5A:C5:5D:B2:EB:C0:F1:FE:E5:DE:A3:E7:F5</span><br><span class="line">a=setup:actpass</span><br><span class="line">a=mid:video</span><br><span class="line">a=extmap:2 urn:ietf:params:rtp-hdrext:toffset</span><br><span class="line">a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time</span><br><span class="line">a=extmap:4 urn:3gpp:video-orientation</span><br><span class="line">a=extmap:5 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01</span><br><span class="line">a=extmap:6 http://www.webrtc.org/experiments/rtp-hdrext/playout-delay</span><br><span class="line">a=sendrecv</span><br><span class="line">a=rtcp-mux</span><br><span class="line">a=rtcp-rsize</span><br><span class="line">a=rtpmap:96 VP8/90000</span><br><span class="line">a=rtcp-fb:96 ccm fir</span><br><span class="line">a=rtcp-fb:96 nack</span><br><span class="line">a=rtcp-fb:96 nack pli</span><br><span class="line">a=rtcp-fb:96 goog-remb</span><br><span class="line">a=rtcp-fb:96 transport-cc</span><br><span class="line">a=rtpmap:98 VP9/90000</span><br><span class="line">a=rtcp-fb:98 ccm fir</span><br><span class="line">a=rtcp-fb:98 nack</span><br><span class="line">a=rtcp-fb:98 nack pli</span><br><span class="line">a=rtcp-fb:98 goog-remb</span><br><span class="line">a=rtcp-fb:98 transport-cc</span><br><span class="line">a=rtpmap:100 H264/90000</span><br><span class="line">a=rtcp-fb:100 ccm fir</span><br><span class="line">a=rtcp-fb:100 nack</span><br><span class="line">a=rtcp-fb:100 nack pli</span><br><span class="line">a=rtcp-fb:100 goog-remb</span><br><span class="line">a=rtcp-fb:100 transport-cc</span><br><span class="line">a=fmtp:100 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f</span><br><span class="line">a=rtpmap:102 red/90000</span><br><span class="line">a=rtpmap:127 ulpfec/90000</span><br><span class="line">a=rtpmap:97 rtx/90000</span><br><span class="line">a=fmtp:97 apt=96</span><br><span class="line">a=rtpmap:99 rtx/90000</span><br><span class="line">a=fmtp:99 apt=98</span><br><span class="line">a=rtpmap:101 rtx/90000</span><br><span class="line">a=fmtp:101 apt=100</span><br><span class="line">a=rtpmap:125 rtx/90000</span><br><span class="line">a=fmtp:125 apt=102</span><br><span class="line">a=ssrc-group:FID 1741418740 3539687233</span><br><span class="line">a=ssrc:1741418740 cname:wR/OHdsj6KVnPajs</span><br><span class="line">a=ssrc:1741418740 msid:d4d74bdc-e8fc-4164-b3ae-3b0297f8753a c9156452-3788-43b4-8d56-f0bf6af8e624</span><br><span class="line">a=ssrc:1741418740 mslabel:d4d74bdc-e8fc-4164-b3ae-3b0297f8753a</span><br><span class="line">a=ssrc:1741418740 label:c9156452-3788-43b4-8d56-f0bf6af8e624</span><br><span class="line">a=ssrc:3539687233 cname:wR/OHdsj6KVnPajs</span><br><span class="line">a=ssrc:3539687233 msid:d4d74bdc-e8fc-4164-b3ae-3b0297f8753a c9156452-3788-43b4-8d56-f0bf6af8e624</span><br><span class="line">a=ssrc:3539687233 mslabel:d4d74bdc-e8fc-4164-b3ae-3b0297f8753a</span><br><span class="line">a=ssrc:3539687233 label:c9156452-3788-43b4-8d56-f0bf6af8e624</span><br></pre></td></tr></table></figure>
<p>ä¸€å¤§å †å„ç§æè¿°æ•°æ®ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»å®˜æ–¹æ‰‹å†ŒæŸ¥æŸ¥éƒ½ä»€ä¹ˆæ„æ€<br>é€šè¿‡ SDP å¯ä»¥ç¡®å®šæœ¬æœºä¸Šçš„åª’ä½“æµçš„ç‰¹æ€§ï¼Œæ¯”å¦‚åˆ†è¾¨ç‡ã€ç¼–è§£ç èƒ½åŠ›ç­‰</p>
<p>å¦ä¸€ä¸ªå°±æ˜¯ ICE Candidateï¼Œå®ƒå¤§ä½“å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">candidate:2134056857 1 udp 2122260223 10.12.36.13 59024 typ host generation 0 ufrag NAac network-id 2</span><br><span class="line"></span><br><span class="line">candidate:1184379673 1 tcp 1518214911 10.12.77.20 9 typ host tcptype active generation 0 ufrag YdMb network-id 1 network-cost 10</span><br></pre></td></tr></table></figure>
<p>è·å–æµè§ˆæ‰€å¤„çš„ç½‘ç»œç¯å¢ƒä¿¡æ¯ï¼ŒICE Candidate äº¤æ¢å…¶å®å°±æ˜¯æµè§ˆå™¨ä¹‹é—´çš„ NAT ç©¿è¶Šã€‚åœ¨å¤„äºä½¿ç”¨äº† NAT è®¾å¤‡çš„ç§æœ‰TCP/IPç½‘ç»œä¸­çš„ä¸»æœºä¹‹é—´éœ€è¦å»ºç«‹è¿æ¥æ—¶éœ€è¦ä½¿ç”¨ NAT ç©¿è¶ŠæŠ€æœ¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/RWebRTC/Blog/pictures/pictures/dataPathways.png" alt="NAT ç©¿è¶ŠæŠ€æœ¯"></p>
<p>ICEï¼Œå…¨åå«äº¤äº’å¼è¿æ¥å»ºç«‹ï¼ˆInteractive Connectivity Establishmentï¼‰,ä¸€ç§ç»¼åˆæ€§çš„ NAT ç©¿è¶ŠæŠ€æœ¯ï¼Œå®ƒæ˜¯ä¸€ç§æ¡†æ¶ï¼Œå¯ä»¥æ•´åˆå„ç§ NAT ç©¿è¶ŠæŠ€æœ¯å¦‚ STUNã€TURNï¼ˆTraversal Using Relay NAT ä¸­ç»§NATå®ç°çš„ç©¿é€ï¼‰</p>
<p>è¿™é‡Œä½¿ç”¨çš„çš„æ˜¯ Google çš„ STUN æœåŠ¡å™¨ï¼Œå›½å†…é‡ç‹—ä¹Ÿæœ‰ä¸€ä¸ªåŒæ ·çš„ï¼Œåœ°å€æ˜¯ <code>stun:cn1-stun.wilddog.com:3478</code></p>
<h2 id="RTCDataChannel"><a href="#RTCDataChannel" class="headerlink" title="RTCDataChannel"></a>RTCDataChannel</h2><p>DataChannel æ˜¯å»ºç«‹åœ¨ PeerConnection ä¸Šçš„ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå®ƒä¸»è¦ç”¨äºå»ºç«‹ä¸€ä¸ªé«˜ååé‡ã€ä½å»¶æ—¶çš„ä¿¡é“ï¼Œå¯ç”¨äºä¼ è¾“ä»»æ„æ•°æ®ï¼Œ<br>ä¾‹å¦‚æˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªæµè§ˆå™¨ä¹‹é—´ä¼ æ•°æ®çš„ App è¿™ä¸ªå°±å¾ˆæœ‰ç”¨äº†ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä¼ è¾“å‡ ä¹æ‰€æœ‰å®¢æˆ·ç«¯è·å–åˆ°æ‰€æœ‰æ•°æ®ã€‚</p>
<p>DataChannelä½¿ç”¨æ–¹å¼å‡ ä¹å’ŒWebSocketä¸€æ ·ï¼Œæœ‰å‡ ä¸ªäº‹ä»¶ï¼š</p>
<ul>
<li>onopen</li>
<li>onclose</li>
<li>onmessage</li>
<li>onerror</li>
</ul>
<p>åŒæ—¶å®ƒæœ‰å‡ ä¸ªçŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡ readyState è·å–ï¼š</p>
<ul>
<li>connecting: æµè§ˆå™¨ä¹‹é—´æ­£åœ¨è¯•å›¾å»ºç«‹ channel</li>
<li>openï¼šå»ºç«‹æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ send æ–¹æ³•å‘é€æ•°æ®äº†</li>
<li>closingï¼šæµè§ˆå™¨æ­£åœ¨å…³é—­ channel</li>
<li>closedï¼šchannelå·²ç»è¢«å…³é—­äº†</li>
</ul>
<p>ä¸¤ä¸ªæš´éœ²çš„æ–¹æ³•:</p>
<ul>
<li>close(): ç”¨äºå…³é—­ channel</li>
<li>send()ï¼šç”¨äºé€šè¿‡ channel å‘å¯¹æ–¹å‘é€æ•°æ®</li>
</ul>
<p>è¿™æ¬¡èŠå¤©å®¤åº”ç”¨æ²¡æœ‰ç”¨åˆ°ï¼Œä½†å®ƒç”¨å¤„æ˜¯éå¸¸å¤§çš„ã€‚</p>
<h2 id="é€šè¿‡é‡ç‹—å»ºç«‹åç«¯ä¸­è½¬æœåŠ¡"><a href="#é€šè¿‡é‡ç‹—å»ºç«‹åç«¯ä¸­è½¬æœåŠ¡" class="headerlink" title="é€šè¿‡é‡ç‹—å»ºç«‹åç«¯ä¸­è½¬æœåŠ¡"></a>é€šè¿‡é‡ç‹—å»ºç«‹åç«¯ä¸­è½¬æœåŠ¡</h2><p>ç°åœ¨ firebase è¿™ä¹ˆæ–¹ä¾¿ï¼Œå°±ä¸ç”¨è‡ªå·±åœ¨æ­å»º websocket æœåŠ¡å™¨è½¬å‘å„ç§ä¿¡ä»¤æ•°æ®äº†ï¼Œè¿™é‡Œç”¨çš„å›½å†…çš„é‡ç‹—æœåŠ¡ã€‚</p>
<p>æ•°æ®ç»“æ„å¤§æ¦‚æ˜¯é…±ç´«çš„ï¼š</p>
<p><img src="http://7xodob.com1.z0.glb.clouddn.com/data0.png" alt="data0"></p>
<p><img src="http://7xodob.com1.z0.glb.clouddn.com/data1.png" alt="data1"></p>
<p><img src="http://7xodob.com1.z0.glb.clouddn.com/data2.png" alt="data2"></p>
<p>ç”¨æˆ·è¿›å…¥çš„æˆ¿é—´å·æ˜¯ roomï¼Œroom ä¸‹é¢éšæœºç”Ÿæˆ useridï¼Œuserid åº•ä¸‹çš„ mailbox å­˜æ”¾å„ç§äº¤æ¢ä¿¡æ¯</p>
<p>ç®€å•çš„ä¸­è½¬å°±ç›‘å¬ï¼Œç»™åŒä¸€ä¸ª room ä¸‹çš„å…¶ä»–ç”¨æˆ·ï¼ˆother useridï¼‰å‘é€é“¾æ¥ä¿¡æ¯ï¼Œç„¶åå…¶ä»–ç”¨æˆ·å“åº”è¿”å›ç»™è‡ªå·±ï¼ˆuseridï¼‰ï¼Œä¿¡å¿ƒå­˜æ”¾åœ¨ mailbox ä¸‹é¢ï¼Œçœ‹çœ‹é‡ç‹—æ–‡æ¡£å¤§æ¦‚å°±æ‡‚äº†ï¼Œå’Œç›´æ¥ç”¨ socket è½¬å‘ä¿¡æ¯æœ‰ç‚¹ä¸ä¸€æ ·ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://github.com/webrtc/samples" target="_blank" rel="noopener">WebRtc DEMO</a></li>
<li><a href="https://blog.wilddog.com/?p=1354" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨é‡ç‹—æ­å»ºè§†é¢‘èŠå¤©å®¤-WebRTCçš„æŠ€æœ¯å®è·µ</a></li>
<li><a href="https://blog.coding.net/blog/getting-started-with-webrtc" target="_blank" rel="noopener">WebRTC çš„å‰ä¸–ä»Šç”Ÿ</a></li>
<li><a href="https://segmentfault.com/a/1190000000436544" target="_blank" rel="noopener">ä½¿ç”¨WebRTCæ­å»ºå‰ç«¯è§†é¢‘èŠå¤©å®¤â€”â€”å…¥é—¨ç¯‡</a></li>
<li><a href="https://segmentfault.com/a/1190000000439103" target="_blank" rel="noopener">ä½¿ç”¨WebRTCæ­å»ºå‰ç«¯è§†é¢‘èŠå¤©å®¤â€”â€”ä¿¡ä»¤ç¯‡</a></li>
<li><a href="https://segmentfault.com/a/1190000000733774" target="_blank" rel="noopener">ä½¿ç”¨WebRTCæ­å»ºå‰ç«¯è§†é¢‘èŠå¤©å®¤â€”â€”ç‚¹å¯¹ç‚¹é€šä¿¡ç¯‡</a></li>
<li><a href="https://segmentfault.com/a/1190000000733779" target="_blank" rel="noopener">ä½¿ç”¨WebRTCæ­å»ºå‰ç«¯è§†é¢‘èŠå¤©å®¤â€”â€”æ•°æ®é€šé“ç¯‡</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2017/06/23/anohana/">PREV</a><a class="next" href="/2015/11/30/é‚£äº›æ¸¸å¼‹äºå¤©ç©ºçš„å¤§é±¼/">NEXT</a></div><div class="copyright"><p>&copy; 2018 <a href="https://ierii.com">èŠŠé‡</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="/js/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>